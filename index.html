<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–û—Ç–∫—Ä—ã–≤–∞–µ–º –∑–∞—è–≤–∫—É</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      text-align: center; 
      margin: 50px; 
      background: #f0f2f5; 
      color: #333;
    }
    .spinner { 
      border: 6px solid #f3f3f3; 
      border-top: 6px solid #007acc; 
      border-radius: 50%; 
      width: 70px; 
      height: 70px; 
      animation: spin 1.2s linear infinite; 
      margin: 30px auto; 
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .step { margin: 15px 0; font-size: 18px; }
  </style>
</head>
<body>
  <h2>–û—Ç–∫—Ä—ã–≤–∞–µ–º –∑–∞—è–≤–∫—É...</h2>
  <div class="spinner"></div>
  <p class="step">1. –û—Ç–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É</p>
  <p class="step">2. –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã</p>
  <p class="step">3. –û—Ç–∫—Ä—ã–≤–∞–µ–º –∑–∞—è–≤–∫—É</p>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const requestId = urlParams.get('id');

    if (!requestId) {
      document.body.innerHTML = '<h2>‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä –∑–∞—è–≤–∫–∏</h2>';
      setTimeout(() => window.close(), 3000);
      throw new Error('No request ID');
    }

    const baseUrl = 'https://techdo.sirius-ft.ru/admin/';
    const hash = `#requests/edit/${requestId}`;
    const tabName = 'techdo_helper_tab';

    // üî• –ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: —É–±—Ä–∞–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–∑–º–µ—Ä–æ–≤ ‚Üí –±—É–¥–µ—Ç –≤–∫–ª–∞–¥–∫–∞!
    const adminTab = window.open(baseUrl, tabName); // ‚Üê –±–µ–∑ 'width=...'!

    if (!adminTab) {
      alert('–ë—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ. –†–∞–∑—Ä–µ—à–∏—Ç–µ –µ–≥–æ.');
      throw new Error('Popup blocked');
    }

    // –ñ–¥—ë–º 5 —Å–µ–∫—É–Ω–¥ ‚Äî –¥–∞—ë–º SPA –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
    setTimeout(() => {
      try {
        if (adminTab.closed) return;

        // –ú–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ö—ç—à ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è SPA
        adminTab.location.hash = hash;
        adminTab.focus();

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –æ–∫–Ω–æ
        setTimeout(() => {
          window.close();
        }, 1000);
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞:', e);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
      }
    }, 5000);
  </script>
</body>
</html>
