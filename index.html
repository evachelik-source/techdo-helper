<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–û—Ç–∫—Ä—ã–≤–∞–µ–º –∑–∞—è–≤–∫—É</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      text-align: center;
      margin: 50px;
      background: #f8f9fa;
      color: #333;
    }
    h1 {
      color: #007acc;
    }
    button {
      padding: 14px 28px;
      font-size: 18px;
      background: #007acc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #005a99;
    }
    .info {
      margin: 20px;
      font-size: 18px;
      font-weight: 500;
    }
    .success {
      color: #28a745;
      font-weight: bold;
    }
    .tip {
      margin: 30px;
      font-size: 16px;
      color: #666;
      max-width: 600px;
      margin: 30px auto;
    }
  </style>
</head>
<body>
  <h1>–û—Ç–∫—Ä—ã–≤–∞–µ–º –∑–∞—è–≤–∫—É ‚Ññ<span id="id">...</span></h1>
  <button id="openBtn">‚ñ∂Ô∏è –û—Ç–∫—Ä—ã—Ç—å –≤ TechDo</button>
  <p class="info" id="status">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>

  <div class="tip">
    <p>üí° –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è:</p>
    <ol style="text-align: left;">
      <li>–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–∫–ª–∞–¥–∫–∞ —Å –∞–¥–º–∏–Ω–∫–æ–π</li>
      <li>–ß–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥ ‚Äî –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è —Ö—ç—à</li>
      <li>–ó–∞—è–≤–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–æ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–π –ø–∞–Ω–µ–ª–∏</li>
      <li>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π ‚Äî –º–æ–∂–µ—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –µ—ë –≤—Ä—É—á–Ω—É—é</li>
    </ol>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const requestId = urlParams.get('id');
    const status = document.getElementById('status');

    if (!requestId) {
      document.getElementById('id').textContent = '–æ—à–∏–±–∫–∞';
      status.textContent = '‚ùå –ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä –∑–∞—è–≤–∫–∏';
      document.getElementById('openBtn').disabled = true;
      throw new Error('No request ID');
    }

    document.getElementById('id').textContent = requestId;

    const baseUrl = 'https://techdo.sirius-ft.ru/admin/';
    const hash = `#requests/edit/${requestId}`;
    const tabName = 'techdo_admin';

    document.getElementById('openBtn').addEventListener('click', () => {
      const btn = document.getElementById('openBtn');
      btn.disabled = true;
      btn.style.background = '#ccc';
      status.textContent = '–û—Ç–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É...';

      const tab = window.open(baseUrl, tabName);

      if (!tab) {
        status.textContent = '‚ùå –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ';
        alert('–†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞');
        btn.disabled = false;
        btn.style.background = '#007acc';
        return;
      }

      status.textContent = '‚è≥ –ñ–¥—ë–º 8 —Å–µ–∫—É–Ω–¥...';

      setTimeout(() => {
        try {
          if (tab.closed) {
            status.textContent = '‚ùå –í–∫–ª–∞–¥–∫–∞ –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞';
            return;
          }

          // –ú–µ–Ω—è–µ–º –¢–û–õ–¨–ö–û —Ö—ç—à ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è SPA
          tab.location.hash = hash;
          tab.focus();
          status.innerHTML = '‚úÖ <span class="success">–ó–∞—è–≤–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞!</span><br>–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å —ç—Ç—É –≤–∫–ª–∞–¥–∫—É';
        } catch (e) {
          status.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + e.message;
          console.error(e);
        }
      }, 8000);
    });
  </script>
</body>
</html>
